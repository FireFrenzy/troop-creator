/*! troopcreator 2016-06-27 */

"use strict";(function(a,b,c,d,e,f,g){a["GoogleAnalyticsObject"]=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date;f=b.createElement(c),g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-72234013-1","auto");var troopCreator=angular.module("troopCreator",["ngRoute","navModule","hc.commonmark","ngDragDrop"]);troopCreator.constant("Modernizr",Modernizr);troopCreator.config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/dashboard/view/dashboard.html",controller:"dashboardCtrl"}).when("/build/:army",{templateUrl:"app/build/view/build.html",controller:"buildCtrl",reloadOnSearch:false}).when("/imprint",{templateUrl:"app/content/imprint.html"}).otherwise({redirectTo:"/"})}]);troopCreator.run(["$rootScope","$location","$window",function(a,b,c){a.$on("$locationChangeSuccess",function(){if(!c.ga||/127\.0\.0\.1/i.test(b.host())){return}c.ga("send","pageview",{page:b.path()})})}]);troopCreator.directive("tooltip",function(){return{restrict:"A",link:function(a,b,c){if(!$("#navi-icon").is(":visible")){$.fn.tooltip.Constructor.DEFAULTS.container="body";$(b).hover(function(){$(b).tooltip("show")},function(){$(b).tooltip("hide")})}}}});troopCreator.directive("selectOnClick",["$window",function(a){return{link:function(b,c){c.on("click",function(){var b=document,c=b.getElementById("selectme"),d,e;if(document.body.createTextRange){d=document.body.createTextRange();d.moveToElementText(c);d.select()}else if(a.getSelection){e=a.getSelection();d=document.createRange();d.selectNodeContents(c);e.removeAllRanges();e.addRange(d)}})}}}]);troopCreator.directive("accordionToggle",function(){return{link:function(a,b){b.on("click",function(){var a=$(b).next(".accordion-container");if(a.is(":hidden")){a.slideDown()}else{a.slideToggle()}a.parent().siblings().find(".accordion-container").slideUp()})}}});troopCreator.filter("wildcardArmy",function(){return function(a,b){if(typeof b!=="undefined"){var c=b.replace(/[^A-za-zÄÖÜäöü?]/g,".*?");var d=new RegExp(".*?"+c+".*?","i");a=$.grep(a,function(a){return d.test(a.name)})}return a}});troopCreator.filter("range",function(){return function(a){var b=[];for(var c=1;c<=a;c++){b.push(c)}return b}});"use strict";troopCreator.controller("buildCtrl",["$scope","$http","$routeParams","$location","$window","$log","$q",function(a,b,c,d,f,g,h){a.$log=g;b.get("./data/"+c.army+".json").success(function(e){var g=$("#"+c.army);a.army=g.data();a.data=[];a.warbj=[];$.each(e.groups,function(b,c){if(c.entries.length!==0){a.data.push(c);if(/^warb|^warj/i.test(c.label)){a.warbj=c}}});a.options={gameCaster:1,gamePoints:75,gameTier:"",gameObjective:"",modalLevel:0};a.vars={tiers:e.tiers,tierOptions:[],tier:{},tierLevel:0,selectedModels:[],casterPoints:0,points:0,costAlterations:[],faAlterations:[],freeModels:{id:[],count:0},factionId:"faction_"+c.army,objectives:["Arcane Wonder","Armory","Bunker","Effigy of Valor","Fuel Cache","Stockpile"],dragging:false,canDrop:false,location:d.search(),error:"There no Errors",gameRelease:"mk3",warbj:a.warbj,data:[],lastController:{}};a.location=d;a.modernizr=Modernizr;$.each(e.tiers,function(b,c){a.vars.tierOptions.push({key:b,label:c.name})});$.each(["minion","mercenary"],function(e,g){if(g!==c.army){b.get("./data/"+g+".json").success(function(b){$.each(b.groups,function(b,c){if(c.entries.length!==0){c.entries=$.grep(c.entries,function(b){if(b.works_for){if($.inArray(a.vars.factionId,b.works_for)!==-1){return true}}else if(b.restricted_to||/^warj|^warb/i.test(b.type)){if(/^ua/i.test(b.type)){return a.getModelById(b.restricted_to)}else{return true}}return false});c.add=g;a.data.push(c)}});if(g==="mercenary"||c.army==="mercenary"){if(!f.ga||/127\.0\.0\.1/i.test(d.host())){a.devAddId()}$.each(a.data,function(b,c){c.entries=a.allowedModels(c.entries);a.vars.data.push(c)});a.restoreSearch();a.$watchGroup(["options.gamePoints","options.gameCaster"],function(){a.updateSearch()});a.$watch(function(){return d.search()},function(){if(JSON.stringify(d.search())!==JSON.stringify(a.vars.location)){a.vars.selectedModels=[];a.options.gameCaster=1;a.options.gamePoints=75;a.options.gameTier="";a.options.gameObjective="";a.restoreSearch()}})}}).error(function(){a.vars.error="error reading "+g+".json";$("#error").modal()})}});var h=new Favico;var i=$("#"+c.army+" img")[0];h.image(i);document.title=a.army.faction+" - Troop Creator";$("#top-menu").find("li").removeClass("active");g.closest("li").addClass("active");$(".btn").focus(function(){this.blur()})}).error(function(){a.vars.error="error reading "+c.army+".json";$("#error").modal()});a.openList=function(){$("#left-col-build").toggleClass("active")};a.checkIsCaster=function(a){return/^warcaster$|^warlock$/i.test(a.type)};a.allowedModels=function(b){if(b){b=$.grep(b,function(b){if(b.hasOwnProperty("restricted_to")){if(typeof b.restricted_to==="string"){if(a.getModelById(b.restricted_to)||b.restricted_to==="*"){return true}}else{var c=false;$.each(b.restricted_to,function(b,d){if(a.getModelById(d)){c=true;return false}});return c}return false}else if(/merc|minion/i.test(b.faction)&&/^warj|^warb/i.test(b.type)){return a.checkCanControl(b)}return true})}return b};a.checkModelAvailable=function(b){var c=a.getModelCost(b,true),d=a.getModelFa(b);if(typeof a.options.gameCaster==="undefined"||a.options.gameCaster.length===0||isNaN(a.options.gameCaster)){return true}if(typeof a.options.gamePoints==="undefined"||a.options.gamePoints.length===0||isNaN(a.options.gamePoints)){return true}if(/^warlock$|^warcaster$/i.test(b.type)&&a.countSelectedModel("^warlock$|^warcaster$").all>=a.options.gameCaster){return true}if(/^warb|^warj/i.test(b.type)&&a.countSelectedModel("^warlock$|^warcaster$|lesserwarlock|journeyman|marshall").all===0){return true}else if(/^warb|^warj/i.test(b.type)){var e=false;$.each(a.vars.selectedModels,function(c,d){if(a.canJoinGroup(d,b)){e=true}});if(e===false){return true}}if(/^soloAtt|^unitCasterAtt/i.test(b.type)){if(a.countSelectedModel("^warlock$|^warcaster$").all===0){return true}else{var f=false;$.each(a.vars.selectedModels,function(b,c){if(/^warlock$|^warcaster$/i.test(c.type)){if(c.group.length>0){var d=0;if(c.hasOwnProperty("attachment")){d=1}if(a.countSelectedModel("^soloAtt|^unitCasterAtt","type",b).all===d){f=true}}else{f=true}}return!f});if(f===false){return true}}}if(/^warb|^warj/i.test(b.type)&&parseInt(a.vars.casterPoints)>0){if(parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(a.vars.casterPoints)<c){return true}}else if(!a.checkIsCaster(b)){if(parseInt(a.options.gamePoints)-parseInt(a.vars.points)<c){return true}}if(!d||d!=="U"){var g=a.countSelectedModel(b.id,"id"),h=false;if(d==="C"&&g.all>0){h=true}else if(d<=g.normal){h=true}if(c===0&&b.cost!==0){h=false}if(h===true){return true}}if(b.hasOwnProperty("restricted_to")&&(!/lesserwarlock|journeyman|marshall/i.test(b.type)||/^ua/i.test(b.type))){var i=b.restricted_to;if(typeof b.restricted_to!=="string"){i=b.restricted_to.join("|")}var j=a.countSelectedModel(i,"id"),k=a.countSelectedModel(b.id,"id");if(j.all===0){return true}if(!/^war/i.test(b.type)||/^war/i.test(b.type)&&b.cost===0){if(!(j.all>0&&j.all>k.all)){return true}}if(/^ua$|^wa$/i.test(b.type)){if(a.searchFreeUnit(b)===false){return true}}}return false};a.countSelectedModel=function(b,c,d){c=typeof c!=="undefined"?c:"type";d=typeof d!=="undefined"?d:false;var e=0,f=0,g=new RegExp(b,"i");if(a.hasOwnProperty("vars")&&a.vars.selectedModels){var h=function(a){$.each(a,function(a,b){if(b.hasOwnProperty(c)&&g.test(b[c])){if(b.freeModel){f++}else{e++}}h(b.group)})};if(d!==false){h(a.vars.selectedModels[d].group)}else{h(a.vars.selectedModels)}}return{normal:e,free:f,all:e+f}};a.checkAttributes=function(a,b){var c=new RegExp(b,"i");if(a.hasOwnProperty("attributes")){var d=a.attributes.join();return c.test(d)}return false};a.checkCanControl=function(b){var c=false;if(b.hasOwnProperty("attributes")){$.each(a.data,function(d,e){$.each(e.entries,function(d,e){if(e.hasOwnProperty("canControlOnly")){c=a.checkAttributes(b,e.canControlOnly);if(c===true){return false}}});if(c===true){return false}})}return c};a.searchFreeUnit=function(b){var c=a.vars.selectedModels.length-1,d=b.restricted_to,e=false;if(typeof b.restricted_to==="string"){d=[b.restricted_to]}for(var f=0;f<=c;f++){if(d.indexOf(a.vars.selectedModels[f].id)!==-1){if(a.countSelectedModel("^"+b.type+"$","type",f).all===0&&a.countSelectedModel(b.id,"id",f).all===0){e=f}}if(e!==false){break}}return e};a.canJoinGroup=function(b,c){var d=a.vars.selectedModels.indexOf(b);if(typeof b==="undefined"||!/^warb|^war|^soloatt|^unitcasteratt/i.test(c.type)&&!c.hasOwnProperty("restricted_to")||b["faction"]!==c["faction"]){return false}if(/^warb|^warj/i.test(c.type)&&!c.hasOwnProperty("restricted_to")){if(/^warlock$|^warcaster$|lesserwarlock|journeyman|marshall/i.test(b.type)){var e=true;if(b.hasOwnProperty("canControlOnly")){e=a.checkAttributes(c,b.canControlOnly)}if(!b.hasOwnProperty("restricted_to")||b.hasOwnProperty("restricted_to")&&b.restricted_to.indexOf(c.id)!==-1){return(!/marshall/i.test(b.type)||/marshall/i.test(b.type)&&a.countSelectedModel("^warjack$","type",d).normal<1&&!/colossal/i.test(c.type))&&e}else{return false}}else{return false}}else if(c.hasOwnProperty("restricted_to")){if(c.restricted_to.indexOf(b.id)!==-1){return a.countSelectedModel("^"+c.type+"$","type",d).all===0&&a.countSelectedModel(c.id,"id",d).all===0}else{return false}}else if(/^soloatt|^unitcasteratt/i.test(c.type)&&!/^warlock$|^warcaster$/i.test(b.type)){return false}return true};a.moveCanDrag=function(a){return!(/uamarshall/i.test(a.type)||a.auto_attached)};a.moveModelStart=function(b,c,d,e){a.vars.dragging={model:d,group:e}};a.moveOverDropable=function(b,c,d,e){setTimeout(function(){if(a.checkDropable(d,e)){$(b.target).addClass("activeDrop").siblings().removeClass("activeDrop");a.vars.canDrop=true}},0)};a.moveOutDropable=function(){$(".activeDrop").removeClass("activeDrop");a.vars.canDrop=false};a.moveBeforeDrop=function(b,c){var d=h.defer();if(a.vars.canDrop){d.resolve()}else{d.reject();$(c.helper.eq(0)).animate({left:0,top:0})}return d.promise};a.checkDropable=function(b,c){if(c===a.vars.dragging.group||a.vars.dragging===false){return false}return a.canJoinGroup(b,a.vars.dragging.model)};a.moveOnDrop=function(b,c,d,e){a.addModel(a.vars.dragging.model,e);a.removeModel(a.vars.dragging.model,a.vars.dragging.group);a.vars.dragging=a.vars.canDrop=false;$(".activeDrop").removeClass("activeDrop")};a.dropCallback=function(b,c){var d=angular.element(c.draggable).scope();a.addModel(d.model)};a.startCallback=function(a,b){var c=b.helper.prevObject.width();b.helper.css({width:c})};a.addModel=function(b,c){c=typeof c!=="undefined"?c:false;if(!a.checkModelAvailable(b)||c!==false){var d=angular.copy(b);d.group=[];if(/^wa$/i.test(b.type)){d.attached=1}var e=false;if(c!==false){e=c}else if(/^warb|^warj/i.test(b.type)){for(var f=a.vars.selectedModels.length-1;f>=0;f--){if(a.canJoinGroup(a.vars.selectedModels[f],b)){e=f;break}}}else if(b.hasOwnProperty("restricted_to")){e=a.searchFreeUnit(b)}else if(/^soloatt|^unitcasteratt/i.test(b.type)){d.sort=0;for(var g=a.vars.selectedModels.length-1;g>=0;g--){var h=0;if(a.vars.selectedModels[g].hasOwnProperty("attachment")){h=1}if(/^warlock$|^warcaster$/i.test(a.vars.selectedModels[g].type)&&a.countSelectedModel("^soloAtt|^unitcasteatt","type",g).all===h){e=g;break}}}if(b.hasOwnProperty("attachment")){var i=angular.copy(a.getModelById(b.attachment));i.auto_attached=1;i.bonded=1;i.group=[];d.group.push(i)}if(e!==false){d.bonded=1;if(/uamarshall/i.test(d.type)){a.vars.selectedModels[e].type="unitMarshall"}a.vars.selectedModels[e].group.push(d)}else if(a.countSelectedModel("^warlock|^warcaster").all===0&&/^warlock|^warcaster/i.test(d.type)){a.vars.selectedModels.splice(0,0,d)}else{a.vars.selectedModels.push(d)}if(/journeyman|lesserwar/i.test(d.type)&&!d.hasOwnProperty("attachment")){a.vars.j=a.vars.selectedModels.indexOf(d);a.vars.lastController=d;$("#journeyman").modal().on("hidden.bs.modal",function(){if(a.vars.selectedModels[a.vars.j].group.length===0){a.removeModel(d)}$(this).off();a.$apply()})}a.calculatePoints()}};a.removeModel=function(b,c){var d=false;var e=false;if(typeof c==="undefined"){d=a.vars.selectedModels;e=a.vars.selectedModels.indexOf(b)}else{d=a.vars.selectedModels[c].group;e=a.vars.selectedModels[c].group.indexOf(b)}if(e!==-1){if(d[e].group.length>0){if(!confirm("If you remove this model all grouped models will also be removed")){return false}}if(typeof c!=="undefined"&&/uamarshall/i.test(d[e].type)){if(!confirm("If you remove this model the unit will lose unitMarshall and all jacks will also be removed")){return false}a.vars.selectedModels[c].type="unit";for(var f=a.vars.selectedModels[c].group.length-1;f>=0;f--){var g=a.vars.selectedModels[c].group[f];if(/^warb|^warj/i.test(g.type)){a.vars.selectedModels[c].group.splice(e,1)}}}d.splice(e,1);a.calculatePoints()}};a.canUseMax=function(b){return!b.useMax&&parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(b.cost)<parseInt(b.costMax)};a.canUseAttached=function(b,c){return b.attached<c&&parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(b.cost*b.attached)<parseInt(b.cost*c)};a.canUseMount=function(b){return!b.mounted&&parseInt(a.options.gamePoints)-parseInt(a.vars.points)+parseInt(b.cost)<parseInt(b.mount)};a.calculatePoints=function(){a.updateSearch();var b=0;var c=0;$.each(a.vars.selectedModels,function(d,e){var f=a.getModelCost(e);if(/^warlock$|^warcaster$/i.test(e.type)){c=c+parseInt(f)}else{b=b+f}$.each(e.group,function(e,f){var g=a.getModelCost(f,false,false,d);if(/^warj|^warb/i.test(f.type)){c=c-g}else{b=b+g}})});if(c<0){a.vars.points=b-c*+1}else{a.vars.points=b}a.vars.casterPoints=c};a.getModelCost=function(b,c,d,e){d=typeof d!=="undefined"?d:false;e=typeof e!=="undefined"?e:false;var f;if(d&&b.hasOwnProperty("costMax")||b.hasOwnProperty("useMax")&&b.useMax){f=parseInt(b.costMax)}else if(b.hasOwnProperty("attached")){f=parseInt(b.cost*b.attached)}else if(b.hasOwnProperty("mounted")&&b.mounted===true){f=parseInt(b.mount)}else{f=parseInt(b.cost)}if(e!==false&&a.vars.selectedModels[e].hasOwnProperty("bonded_bonus")){f=f-a.vars.selectedModels[e].bonded_bonus}return f};a.isBonusCost=function(b,c,d){c=typeof c!=="undefined"?c:true;var e=b.cost;if(b.hasOwnProperty("freeModel")&&b.freeModel===1&&b.cost===0){return true}else if(/^unit/i.test(b.type)){if(b.useMax===true){e=b.costMax}}else if(b.hasOwnProperty("mount")&&b.mounted===true){e=b.mount}else if(/^wa$/i.test(b.type)){e=b.cost*b.attached}return e!==a.getModelCost(b,c,false,d)};a.getModelFa=function(a){var b=a.fa;if(b>100){b="U"}if(!b){b="C"}return b};a.updateSearch=function(){var b={},c=[];var e=function(a){$.each(a,function(a,b){var d=b.id;if(b.hasOwnProperty("useMax")&&b.useMax===true){d+=":m"}if(b.hasOwnProperty("bonded")&&b.bonded===1){d+=":b"}if(b.hasOwnProperty("freeModel")&&b.freeModel===1){d+=":f"}if(b.hasOwnProperty("mounted")&&b.mounted===true){d+=":mo"}if(b.hasOwnProperty("auto_attached")&&b.auto_attached===1){d+=":aa"}if(b.hasOwnProperty("attached")){d+=":a#"+b.attached}c.push(d);e(b.group)})};e(a.vars.selectedModels);b.sel=btoa(c+"@"+a.vars.gameRelease);b.caster=a.options.gameCaster;b.points=a.options.gamePoints;b.tier=a.options.gameTier===0?"":a.options.gameTier;b.objective=a.options.gameObjective;a.vars.location=b;d.search(a.vars.location)};a.restoreSearch=function(){var b=d.search();if(b.points){a.options.gamePoints=b.points}if(b.caster){a.options.gameCaster=b.caster}if(b.tier){a.options.gameTier=b.tier;a.vars.tier=a.vars.tiers[a.options.gameTier]}if(b.objective){a.options.gameObjective=b.objective}if(b.sel){var c=atob(b.sel),e=c.replace("@"+a.vars.gameRelease,"").split(",");if(c.indexOf("@"+a.vars.gameRelease)===-1){a.vars.error="Your Link ist not compatible with the Current Game Release. We cannot restore this please build an List with the new Models!";$("#error").modal()}else{$.each(e,function(b,c){a.addModelByString(c)})}}a.calculatePoints()};a.addModelByString=function(b){var c=b.split(":");var d={};$.each(a.data,function(a,b){$.each(b.entries,function(a,b){if(b.id===c[0]){d=angular.copy(b);return false}});if(d.length>0){return false}});if(!$.isEmptyObject(d)){d.group=[];for(var e=0;e<=c.length;e++){if(c[e]==="bonded"||c[e]==="b"){d.bonded=1;if(/^soloatt|^unitcasteratt/i.test(d.type)){d.sort=0}}if(c[e]==="useMax"||c[e]==="m"){d.useMax=true}if(c[e]==="freeModel"||c[e]==="f"){d.freeModel=1;d.realCost=d.cost;d.cost=0}if(/^attached/i.test(c[e])||/^a#/i.test(c[e])){var f=c[e].split("#");d.attached=parseInt(f[1])}if(c[e]==="mounted"||c[e]==="mo"){d.mounted=true}if(c[e]==="aa"){d.auto_attached=1}}if(d.bonded===1){var g=a.vars.selectedModels.length-1;if(/uamarshall/i.test(d.type)){a.vars.selectedModels[g].type="unitMarshall"}a.vars.selectedModels[g].group.push(d)}else{a.vars.selectedModels.push(d)}}};a.getModelById=function(b){var c=false;$.each(a.data,function(a,d){$.each(d.entries,function(a,d){if(d.id===b){c=d;return true}});if(c){return true}});return c};a.clearList=function(){a.vars.selectedModels=[];a.calculatePoints()};a.saveListAsFav=function(){var a=window.location.href;var b=document.title;if("addToHomescreen"in window&&window.addToHomescreen.isCompatible){addToHomescreen({autostart:false,startDelay:0}).show(true)}else if(window.sidebar&&window.sidebar.addPanel){window.sidebar.addPanel(b,a,"")}else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){$(this).attr({href:a,title:b,rel:"sidebar"}).off(e);return true}else if(window.external&&"AddFavorite"in window.external){window.external.AddFavorite(a,b)}else{alert("Press "+(/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+"+D to bookmark this page.")}return false};a.devAddId=function(){$.each(a.data,function(a,b){$.each(b.entries,function(a,b){b.name=b.id+" - "+b.name})})};a.notSorted=function(a){if(!a){return[]}return Object.keys(a)}}]);"use strict";troopCreator.controller("dashboardCtrl",["$scope","$http",function(a,b){a.dataLoaded=false;b.get("https://api.github.com/repos/pumpi/troop-creator/issues").success(function(b,c,d,e){a.data=b;a.dataLoaded=true}).error(function(a,b,c,d){alert("cannot load Issues from Github")})}]);"use strict";angular.module("navModule",[]).directive("navD",function(){return{templateUrl:"nav.html",replace:true,controller:"navCtrl"}}).controller("navCtrl",["$scope","$rootScope","$http","$timeout","$location",function(a,b,c,d,e){c.get("./data/nav.json").success(function(b,c,d,e){a.armys=b}).error(function(a,b,c,d){alert("error reading navigation")});a.menuActive=false;a.menuToggle=function(){if($("#navi-icon").is(":visible")){a.menuActive=!a.menuActive;if(a.menuActive){$("#top-menu").slideDown()}else{$("#top-menu").slideUp()}}}}]);
//# sourceMappingURL=troopcreator.min.js.map